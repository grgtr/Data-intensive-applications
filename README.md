# Data-intensive applications

## I Модель отказов распределенной системы, репликация и шардирование (определение и причины), способы решардирования

#### Типы отказов
 - **Crash failure** Узел перестает функционировать, не отправляет сообщения и не отвечает.
  - **Limited failure** Узел ведет себя произвольно, включая отправку ложных данных.
  - **Network partition** Соединение между узлами прерывается, что приводит к разделению сети. Граф серверов распался на компоненты, в которых сохранились разные версии одних и тех же данных. После восстановления связей не понятно, какие данные должны стать актуальными.
  - **Latency** Задержка в доставке сообщений, не гарантирующая своевременную синхронизацию.
  - **Skew** Сдвиг, возникает разница между часами на нодах.

####  Репликация и шардирование (определение и причины):
 - **Репликация** — это создание копий данных или процессов для обеспечения отказоустойчивости, доступности и улучшения производительности.
 - **Шардирование** - это разбиение данных на фрагменты (шарды), которые распределяются между узлами.
    Причины:
     - Масштабируемость: Данные равномерно распределяются между узлами.
     - Улучшение производительности: Параллельная обработка запросов.
     - Устойчивость к отказам: Отказ одного шарда затрагивает только его данные.


####  Способы решардирования
Проблемы возникают при появлении нового шарда, придётся переносить на него часть старых данных для равномерного распределения. Поэтому существуют shard managers.
 - Можно создать сабшарды, если мы знаем верхнее ограничение на количество шардов.
 - Консистентное хеширование. Представим кольцо от 0 до INTMAX. Отметим на нём хеши айдишников шардов. Каждый раз, добавляя ключ, берём его хеш, ищем его на кольце и находим ближайший по часовой стрелке шард. Добавляем новый шард -- просто отмечаем его хеш на кольце. При хорошей хеш функции данные распределяются примерно равномерно.Ноды удобно будет хранить в дереве поиска.

## II RPC, TCP, сериализация (protobuf, json)

 - **RPC** -  Remote procedure call. Удалённо вызываем методы серверного кода.
 - **TCP** -  Transmission Control Protocol. Транспортный протокол, обеспечивающий надежную доставку данных в сети.
    - Гарантирует доставку всех пакетов в правильном порядке.
    - Использует подтверждения (ACK) и повторные передачи.

 - Cериализация (protobuf, json):
    -   **Protobuf** - Разработан Google. Бинарный формат: компактный и быстрый.
        Требует предварительного определения схемы (описание структуры данных в .proto-файле).
        ```
        message User {
            int32 id = 1;
            string name = 2;
        }
        ```
    - **Json** - Читаемый для человека текстовый формат. Меньшая производительность по сравнению с бинарными форматами. Удобен для систем, где важна совместимость и простота.
    - **XML** - Читаемый текстовый формат, но избыточный и медленный. Устаревает в пользу JSON и Protobuf.

## III Основные характеристики RAM, дисков и сети. Модель внешней памяти, базовые виды задач

|         | size   | latency (DC / cross DC) | throughput |
| ------- | ------ | ----------------------- | ---------- |
| Network | ---    | 1 ms / 10 ms            | 1 Gb / s   |
| RAM     | 1 Tb   | 100 ns                  | 10 Gb / s  |
| HDD     | 100 Tb | 10 ms                   | 1 Gb / s   |
| SSD     | 100 Tb | 100 micro s             | 10 Gb / s  |
#### RAM
- Лента. Минимальный размер записи порядка байта.
- Характеристики:
   - Производительность. Время доступа: 100 ns. Пропускная способность: десятки гигабайт в секунду.
    - Объем ограничен стоимостью и архитектурными особенностями (например, 16–128 ГБ на сервере).
    - Данные, расположенные близко друг к другу, читаются быстрее. Повторное использование данных ускоряет доступ.
#### HDD
- Крутящийся диск. Минимальый размер записи порядка 512 байт.
- Характеристики:
    - Время доступа: миллисекунды 10 ms.
    - Используется для архивирования и долгосрочного хранения данных.

#### SSD
- В блоке порядка 512 страниц.
- Характеристики:
    - Время доступа: микросекунды (10–100 мкс).
    - Высокая скорость чтения/записи
    - Подходит для высокопроизводительных систем.
    - Имеет ограниченное количество циклов записи.

#### Сеть
- Пропускная способность:
    - Количество данных, которое может быть передано за единицу времени (например, 1 Гбит/с).
    - Ограничивает скорость обмена между узлами в распределенных системах.
- Задержка (latency):
    - Время, необходимое для передачи пакета от одного узла к другому.
    - Типичные значения: десятки миллисекунд в WAN, миллисекунды в локальных сетях.
- Пакетные потери:
  - Приводят к повторным передачам и увеличению времени выполнения операций.


#### Модель внешней памяти
Модель внешней памяти (External Memory Model) используется для оценки алгоритмов, которые работают с данными, превышающими объем оперативной памяти.

 - Основная идея:
    - Модель фокусируется на количестве операций ввода/вывода (I/O), так как они гораздо дороже операций в оперативной памяти.
    - Данные хранятся в блоках фиксированного размера (например, 4 КБ).
 - Пример:
   -  B-tree: Многовершинная структура, минимизирующая количество операций I/O.
    - External Merge Sort: Эффективный алгоритм сортировки больших данных, использующий несколько этапов слияния.

#### Базовые виды задач
1. Сортировка внешней памяти.
Пример: External Merge Sort. Использует минимальное количество операций I/O.
2. Поиск.
Используются структуры, оптимизированные для I/O (B-tree, LSM-tree).
3. Обработка больших данных:
Распределенные системы (Hadoop, Spark) эффективно используют дисковую и сетевую подсистемы для работы с данными.
4. Кэширование:
Позволяет уменьшить количество обращений к дискам, используя принципы локальности.

## IV [ExtSort](https://en.wikipedia.org/wiki/External_sorting)
**External sorting** - это алгоритм сортировки, разработанный для обработки данных, которые не помещаются в оперативную память и хранятся на диске или других устройствах внешней памяти. Основная цель — минимизация количества операций ввода-вывода (I/O), так как они являются самым затратным этапом работы с внешней памятью.

Aлгоритмы внешней сортировки можно анализировать в модели внешней памяти . В этой модели кэш или внутренняя память размера **M** и неограниченная внешняя память разделены на блоки размера **B** , а время работы алгоритма определяется количеством передач памяти между внутренней и внешней памятью. Как и их аналоги , не обращающие внимания на кэш , асимптотически оптимальные алгоритмы внешней сортировки достигают времени работы  $${\displaystyle O\left({\tfrac {N}{B}}\log _ {\tfrac {M}{B}}{\tfrac {N}{B}}\right)}$$. 

## V B-tree
 [B-tree итмо](https://neerc.ifmo.ru/wiki/index.php?title=B-%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE)















